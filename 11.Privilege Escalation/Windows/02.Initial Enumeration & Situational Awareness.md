# Initial Enumeration & Situational Awareness
**Concept:** Before running noisy automated scripts (like WinPEAS or Seatbelt), manual enumeration provides a baseline of the environment, user context, and defensive posture.
## 1. User & Context Enumeration
**Goal:** Understand "Who am I?", "What privileges do I have?", and "Who else is here?".
```powershell
# Description: Check current user, privileges, and groups
# Syntax: whoami /all
whoami /all

# Description: List all users on the system
net user

# Description: Check members of the local Administrators group
net localgroup administrators

# Description: Check currently logged-in users (Look for active admins to avoid collision)
query user
```
**Critical Checks:**
- **SeImpersonatePrivilege:** If enabled, you are likely one step away from SYSTEM (JuicyPotato, PrintSpoofer).
- **SeDebugPrivilege:** Allows inspecting/modifying other processes memory (Process Injection).
## 2. System Information
**Goal:** Identify OS version, architecture, and patch level to correlate with Kernel exploits (e.g., CVE-2020-0787).
```powershell
# Description: Comprehensive system info (OS, Hotfixes, Network cards)
systeminfo

# Description: List installed patches (Hotfixes) quickly
wmic qfe get Caption,Description,HotFixID,InstalledOn

# Description: List installed software (Note: This is slow and noisy)
wmic product get name,version,vendor
```
**OPSEC Warning:** `wmic product` initiates a consistency check on MSI packages which generates significant Event Log noise (Event ID 1035). Use registry checks or `Get-ItemProperty` in PowerShell for stealth.
## 3. Network Information
**Goal:** Identify internal interfaces, routing tables, and active connections.
```powershell
# Description: Interface configuration
ipconfig /all

# Description: ARP table (Neighboring hosts)
arp -a

# Description: Routing table (Internal subnets/VPNs)
route print

# Description: Active connections (Listen ports = Potential internal services)
netstat -ano
```
# Enumerating Protections
**Concept:** Identify AV, EDR, and Application Control policies (AppLocker) to determine which tools can be safely dropped or executed.
## 1. Windows Defender / AV Status
```powershell
# Description: Check Defender status, RealTimeProtection, and Exclusion paths
Get-MpComputerStatus | Select-Object -Property AntivirusEnabled,RealTimeProtectionEnabled,ExclusionPath
```
## 2. AppLocker Enumeration
**Goal:** Determine if we can execute binaries (`.exe`) or scripts (`.ps1`) from specific directories.
```powershell
# Description: List effective AppLocker policy rules
Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections

# Description: Test if a specific binary is allowed to run
Get-AppLockerPolicy -Local | Test-AppLockerPolicy -path C:\Windows\System32\cmd.exe -User Everyone
```
**Bypass Hint:** If AppLocker is active, check writeable directories usually excluded like `C:\Windows\Tasks` or `C:\Windows\Temp`.
# Advanced Enumeration: Communication & Pipes
**Concept:** Windows processes often communicate via 
**Named Pipes** (`\\.\pipe\`). If a privileged process creates a pipe with weak permissions (e.g., `Everyone` can Write), a low-privileged user might be able to send malicious input or impersonate the connecting client.
## 1. Named Pipe Enumeration
**Goal:** List available pipes.
```powershell
# Description: List named pipes using Sysinternals Pipelist (if available)
pipelist.exe /accepteula

# Description: List named pipes using PowerShell
gci \\.\pipe\
```
## 2. Permission Analysis (AccessChk)
**Goal:** Identify pipes that are writable by standard users.
```powershell
# Description: Check permissions of a specific pipe (e.g., WindscribeService)
# Look for "RW Everyone" or "RW BUILTIN\Users"
accesschk.exe /accepteula -w \pipe\WindscribeService -v
```
**Exploitation Scenario:** If a privileged service reads data from a pipe you can write to, you might trigger a Buffer Overflow or, more commonly, force the service to authenticate to a rogue SMB server you control (Relay Attack) or impersonate your token if `SeImpersonatePrivilege` is involved.