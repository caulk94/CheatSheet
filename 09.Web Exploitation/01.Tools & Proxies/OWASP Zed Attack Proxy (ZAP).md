# OWASP Zed Attack Proxy (ZAP)
**Concept:** ZAP is your primary interception proxy and vulnerability scanner for web assessments. Unlike Burp Suite, ZAP's Fuzzer is not throttled in the free version, making it superior for heavy brute-forcing without a license. 
**Role:** Man-in-the-Middle (MitM), Fuzzer, Crawler, and Scanner.
## 1. Interception & Setup (MitM)
**Goal:** Route browser traffic through ZAP to inspect and modify requests on the fly.
### Standard Proxy Toggle
By default, interception is **OFF** (Green traffic light).
- **Traffic Light Button (Top Bar):** Green = Pass through | Red = Break (Intercept).
- **Shortcut:** `CTRL+B` (Toggle Break).
### The HUD (Heads Up Display)
ZAP offers an in-browser overlay to control the proxy without switching windows.
- **Enable:** Click the "HUD" button (Radar icon) in the top toolbar.
- **Controls:**
    - **Left Pane:** Scope & Site Tree.
    - **Right Pane:** Spider & Active Scan triggers.
    - **Bottom Pane:** History & Request Editor.
    - **Break Button:** Second button on the left (Pauses requests).

**OPSEC Warning:** The HUD injects JavaScript into the target page. 
**Do not use** on sensitive production targets where DOM integrity is critical or strictly monitored (e.g., banking apps with anti-tamper mechanisms).
## 2. Reconnaissance (Spidering)
**Goal:** Map the application structure (directories, parameters, hidden endpoints) before attacking.
### Standard Spider
Fast, follows HTML links (`<a href>`).
- **Execution:** Right-click Target in History -> `Attack` -> `Spider`. 
- **HUD:** Click "Spider Start" (2nd button, Right Pane).
### AJAX Spider
Slower, uses a headless browser to render DOM and trigger JavaScript (XHR/Fetch).
- **Use Case:** Single Page Applications (SPAs) or heavy JS sites.
- **Execution:** Right-click Target -> `Attack` -> `Ajax Spider`.
## 3. Weaponization: The Fuzzer
**Concept:** ZAP's answer to Burp Intruder. Used for brute-forcing, directory busting, and parameter fuzzing. 
**Advantage:** **No throttling** in the free version.
### Configuration Workflow
1. **Select Request:** Locate request in History -> Right-click -> `Attack` -> `Fuzz`.
2. **Set Location:** Highlight the data to fuzz (e.g., `test` in `/test/`) -> Click `Add`.
3. **Set Payloads:** Click `Add` in the Payloads window.
    - **File:** Load custom wordlist.
    - **File Fuzzers:** Use built-in libraries (e.g., DirBuster, FuzzDB).
    - **Numberzz:** Generate integer sequences (IDOR testing).
4. **Set Processors:** Modify payloads on the fly (Encoding).
    - _Example:_ To fuzz a URL parameter safely, add `URL Encode` processor.
    - _Preview:_ Click `Generate Preview` to verify encoding.
### Optimization
- **Threads:** Increase `Concurrent Scanning Threads` to `20+` for speed.
- **Strategy:**
    - `Depth First`: Test all payloads on one input before moving to the next.
    - `Breadth First`: Test one payload across all inputs parallelly.
## 4. Operational Tradecraft: Automatic Modification
**Goal:** "Live off the tool" by automating repetitive tasks (headers, hidden fields) without manual interception.
### Replacer (Request Modification)
Automatically inject or replace headers to bypass filters or tag traffic.
- **Access:** `CTRL+R` or Options -> `Replacer`.

**Scenario: User-Agent Spoofing (Bypass WAF/Filters)** 

| **Setting**      | **Value**                                  |     |
| :--------------- | :----------------------------------------- | --- |
| *Description*  | `HTB User-Agent`                           |     |
| *Match Type*   | `Request Header (will add if not present)` |     |
| *Match String* | `User-Agent`                               |     |
| *Replacement*  | `HackTheBox Agent 1.0`                     |     |
| *Enable*       | `True`                                     |     |
### Response Modification (Client-Side Controls)
Bypass disabled buttons or hidden fields purely on the client side.
- **Method A (Replacer):** Automatically change HTML in response body.
    - _Match:_ `maxlength="3"`
    - _Replace:_ `maxlength="100"`
- **Method B (HUD Lightbulb):**
    - Click the **Lightbulb Icon** (Left Pane) to `Unhide/Enable` all fields instantly.
    - _Utility:_ Reveals hidden debug parameters or enables "Admin Only" buttons enforced only by HTML.
## 5. Exploitation: Active Scanner
**Goal:** Automated vulnerability discovery (SQLi, XSS, Command Injection). **Warning:** This is **Extremely Noisy**. It generates thousands of malicious requests.
- **Execution:** Right-click Target in Site Tree -> `Attack` -> `Active Scan`.
- **Analysis:** Monitor the `Alerts` tab for Red (High) flags.
- **Verification:**
    1. Select the Alert (e.g., `SQL Injection`).
    2. Review the `Request/Response` tabs.
    3. Right-click -> `Open/Resend with Request Editor` to verify manually (Triage).
## 6. Extensions (ZAP Marketplace)
**Goal:** Extend capabilities with community add-ons
- **Access:** Toolbar -> `Manage Add-ons` (Brick icon) -> `Marketplace`.
- **Essential Add-ons:**
    - **FuzzDB:** Massive collection of attack payloads (SQLi, XSS, LFI).
    - **Wappalyzer:** Technology stack fingerprinting.
    - **Retire.js:** Scanner for vulnerable JS libraries.